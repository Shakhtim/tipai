# TipAI.ru Deployment Guide

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –¥–µ–ø–ª–æ—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ production —Å–µ—Ä–≤–µ—Ä.

## üìÅ –°–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è

### üé® Frontend Only (`front-deploy.sh`)
–î–µ–ø–ª–æ–∏—Ç —Ç–æ–ª—å–∫–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ):
```bash
./front-deploy.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ GitHub
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`npm install`)
- –°–æ–±–∏—Ä–∞–µ—Ç production build (`npm run build`)
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç Nginx

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ UI/UX
- –ü—Ä–∞–≤–∫–∏ —Å—Ç–∏–ª–µ–π, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, —Å—Ç—Ä–∞–Ω–∏—Ü
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend

---

### üîß Backend Only (`back-deploy.sh`)
–î–µ–ø–ª–æ–∏—Ç —Ç–æ–ª—å–∫–æ –±—ç–∫–µ–Ω–¥ (Node.js API):
```bash
./back-deploy.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ GitHub
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`npm install`)
- –°–æ–±–∏—Ä–∞–µ—Ç TypeScript (`npm run build`)
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç PM2 –ø—Ä–æ—Ü–µ—Å—Å —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º env
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ API endpoints
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ (YandexGPT, GigaChat –∏ —Ç.–¥.)
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ .env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

---

### üöÄ Full Deploy (`deploy.sh`)
–ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π frontend + backend:
```bash
./deploy.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ GitHub
- –î–µ–ø–ª–æ–∏—Ç backend (build + PM2 restart)
- –î–µ–ø–ª–æ–∏—Ç frontend (build + Nginx reload)
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ë–æ–ª—å—à–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ frontend –∏ backend
- –ü–æ—Å–ª–µ –∫—Ä—É–ø–Ω—ã—Ö feature —Ä–µ–ª–∏–∑–æ–≤
- –ö–æ–≥–¥–∞ –Ω–µ —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ –∏–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

---

## üîß –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏
–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```bash
cd /var/www/tipai
chmod +x front-deploy.sh back-deploy.sh deploy.sh
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
```bash
# Node.js –∏ npm
node --version  # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å v20+
npm --version

# PM2
pm2 --version

# Nginx
nginx -v

# Git
git --version
```

### 3. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ PM2 –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è tipai-backend
```bash
pm2 list
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: tipai-backend
```

–ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ-–¥—Ä—É–≥–æ–º—É, –æ–±–Ω–æ–≤–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤ `back-deploy.sh` –∏ `deploy.sh`.

---

## üìã –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä–∞–≤–∫–∏ –≤ UI (—Ç–æ–ª—å–∫–æ —Å—Ç–∏–ª–∏/–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
```bash
cd /var/www/tipai
./front-deploy.sh
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API –ª–æ–≥–∏–∫–∏
```bash
cd /var/www/tipai
./back-deploy.sh
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
cd /var/www/tipai
./deploy.sh
```

---

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: "Permission denied"
```bash
chmod +x *.sh
```

### –û—à–∏–±–∫–∞: PM2 –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞
pm2 list

# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –æ–±–Ω–æ–≤–∏—Ç—å –∏–º—è –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö
nano back-deploy.sh  # –∏–∑–º–µ–Ω–∏—Ç—å tipai-backend –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è
```

### –û—à–∏–±–∫–∞: Nginx reload failed
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
sudo tail -f /var/log/nginx/error.log
```

### –û—à–∏–±–∫–∞: npm install failed
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –∏ node_modules
rm -rf node_modules package-lock.json
npm install
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### –õ–æ–≥–∏ Backend
```bash
# –°–º–æ—Ç—Ä–µ—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
pm2 logs tipai-backend

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫
pm2 logs tipai-backend --lines 50

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
pm2 logs tipai-backend --err
```

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
# PM2
pm2 status

# Nginx
sudo systemctl status nginx

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
pm2 monit
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å backend API
curl http://localhost:5000/api/health

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å frontend
curl -I https://tipai.ru
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ:**
- –°–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `sudo` –¥–ª—è Nginx - —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –ø—Ä–∞–≤–∞
- `authorized_key.json` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ `.gitignore` (—É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω)
- `.env` —Ñ–∞–π–ª—ã –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ git (—É–∂–µ –≤ `.gitignore`)

---

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/var/www/tipai/
‚îú‚îÄ‚îÄ front-deploy.sh      # –î–µ–ø–ª–æ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
‚îú‚îÄ‚îÄ back-deploy.sh       # –î–µ–ø–ª–æ–π –±—ç–∫–µ–Ω–¥–∞
‚îú‚îÄ‚îÄ deploy.sh            # –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π
‚îú‚îÄ‚îÄ DEPLOY.md            # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ client/              # React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ dist/            # Production build
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ server/              # Node.js API
    ‚îú‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ dist/            # Compiled TypeScript
    ‚îú‚îÄ‚îÄ .env             # Environment variables
    ‚îî‚îÄ‚îÄ package.json
```

---

## üéØ Best Practices

1. **–í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ git pull –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**
2. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è** (`pm2 logs`)
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ localhost –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –Ω–∞ production**
4. **–î–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ .env —Ñ–∞–π–ª–æ–≤**
5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `front-deploy.sh` –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö UI –ø—Ä–∞–≤–æ–∫**

---

## üÜò –ü–æ–º–æ—â—å

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `pm2 logs tipai-backend`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: `pm2 status`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Nginx: `sudo nginx -t`
4. –û—Ç–∫–∞—Ç–∏—Ç–µ—Å—å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–º–º–∏—Ç: `git reset --hard HEAD~1`
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ: `./deploy.sh`

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-02
**–í–µ—Ä—Å–∏—è:** 1.0.0
